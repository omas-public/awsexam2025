# 問1.
- ネットワークアドレス:192.168.10.64/26
- IPアドレス: 192.168.10.66
- ルーティングテーブル:192.168.10.65(デフォルトゲートフェイ)
# 問2.
- ネットワークアドレス: 192.168.10.64/26、192.168.10.128/26
- IPアドレス: 192.168.10.65(eth0)、192.168.10.129(eth1)
- ルーティングテーブル:192.168.10.64/26(直結)、192.168.10.128/26(直結)、- 192.168.10.192/26 から 192.168.10.130
# 問3.
- ネットワークアドレス:192.168.10.128/26、192.168.10.192/26
- IPアドレス: 192.168.10.130(eth0)、192.168.10.193(eth1)
- ルーティングテーブル:192.168.10.128/26(直結)、192.168.10.192/26(直結)、192.168.10.64 から 192.168.10.129
# 問4.
- ネットワークアドレス:192.168.10.192/26
- IPアドレス:192.168.10.194
- ルーティングテーブル:192.168.10.193(デフォルトゲートウェイ)
# 問5.
## VPCの作成
- awsのコンソールにログインしたら、検索欄からVPCと検索する。お使いのVPCからVPCを作成を選択。
- VPCのみにして、名前を入力。IPv4CIDRは192.168.10.0/24を入力。VPCを作成。
- 作成したVPCを選択してアクションからVPCの設定を編集をして、DNSホスト名と解決を有効化。
## パブリックサブネットとプライベートサブネットのペアを2つ構築する
- VPCダッシュボードのサブネットを選択。サブネットを作成。
- 先程のVPCを選択する。サブネット名を入力。アベイラビリティゾーンはパブリックサブネットのペアは同じものにする。プライベートサブネットはRDSを作成する際に異なるものにしなければならないので異なるアベイラビリティゾーンを選択する。
- サブネットのIPv4CIDRは
public subnet1:192.168.10.0/27
public subnet2:192.168.10.32/27
private subnet1: 192.168.10.64/27
private subnet2: 192.168.10.96/27　　とする。
## ルートテーブルの作成
- VPCダッシュボードのルートテーブルを選択。ルートテーブルを作成。
- パブリック用のルートテーブルとプライベート用のルートテーブルの2つを作成する。
- それぞれ作ったルートテーブルを選択して、下の項目のサブネットの関連付けを選択して編集する。先程作ったパブリックサブネットとプライベートサブネットをそれぞれのルートテーブルに関連付ける。
- パブリック用のルートテーブルはインターネットへ接続するので、VPCダッシュボードからインターネットゲートウェイを選択して、作成。
- パブリック用ルートテーブルのルートの項目からルートを編集。
ルートを追加して、送信先0.0.0.0/0として、先程作成したインターネットゲートウェイをターゲットとする。その際に、インターネットゲートウェイIDを間違えないようにする。
## 踏み台サーバとWEBサーバを作成
- 検索欄から、EC2で検索。EC2の左の項目からインスタンスを選択。
- 右上のインスタンスを起動を選択。
名前を入力。Amazon Linuxを選択する。マシンイメージ、インスタンスタイプは無料利用枠を選択。
- キーペアを使ってログインをするのでキーペアを作成する。
キーペアのタイプはRSAとする。ファイル形式は.pemとする。ファイルがダウンロードされるのでそのファイルを.sshへ移動させる。
- ネットワーク設定を編集する。VPCは先程作成したVPCを選択。サブネットはパブリックサブネットを選択する。
- パブリックIPの自動割当を有効化にする。
- セキュリティグループを作成する。
踏み台サーバのセキュリティグループ
名前を入力。インバウンドセキュリティグループのルールからタイプsshのソースが0.0.0.0/0にする。
webサーバのセキュリティグループ
名前を入力。インパウンドセキュリティグループのルールからsshのソースをカスタムとしてソースを踏み台サーバのプライベートIPv4アドレスを入力する。
セキュリティグループルールを追加からタイプをhttpにしてソースを0.0.0.0/0にする。
- 任意でプライベートIPv4アドレスを指定したい場合は、高度なネットワーク設定からプライマリIPを設定する。(192.168.10.4~192.168.10.254の範囲。)
- インスタンスを起動を押す。
## RDSでDBサーバを作成
- 検索欄からRDSを入力。
- 左側の項目からサブネットグループを選択。DBサブネットグループを作成を選択。
- 説明に日本語は入力できないので注意。
- 先程作成したVPCを選択。
- 作成したプライベートサブネットのアベイラビリティゾーンをそれぞれ選択する。
- サブネットは、作成した２つの異なるアベイラビリティゾーンのプライベートサブネットを選択。その後作成。
- 左側の項目からデータベースを選択。データベースの作成。
- データベース作成方法は標準作成。エンジンのオプションはMySQLを選択
- テンプレートは無料利用枠を選択。
- DBインスタンス識別子、マスターユーザー名、マスターパスワードは自分で入力する。(mysqlへろぐいんする際に使用するので忘れないようにする。)
- インスタンスの設定は料金の発生を極力控えるためdb.t3.microを使用するのがおすすめ。
- VPCは先程作成したものを使う。
- セキュリティグループの作成。
EC2からセキュリティグループを選択し、セキュリティグループを作成。
VPCは先ほどと同様のものを選択、インバウンドルールを追加し、mysql/auroraを選択。(2つ追加する。)ソースを先程の踏み台サーバとWEBサーバのIPを入力。セキュリティグループを作成。
- 作成したセキュリティグループを選択する。アベイラビリティゾーンは、踏み台サーバとWEBサーバのサブネットと同じものとする。
- データベースの作成。
## 踏み台サーバにsshで接続して、mysqlをインストール、wordpressの作成。
- 踏み台サーバのインスタンスを起動する。踏み台サーバを選択してインスタンスの状態からインスタンスを開始を選択。
ssh -i .ssh/(先程作成したmy-keyのファイル名) ec2-user@踏み台サーバのパブリックIPアドレス   をターミナルで入力。
WARNING: UNPROTECTED PRIVATE KEY FILE!と表示された場合は、my-keyの権限を変更する。chmod 400 .ssh/my-keyのファイル名
- ログインに成功したら、mysqlをインストールする。
sudo dnf -y install https://dev.mysql.com/get/mysql84-community-release-el9-1.noarch.rpm
sudo dnf -y install mysql mysql-community-client
sudo dnf -y install mysql-community-server
- 作成したRDSのmysqlにログインする。
mysql -h エンドポイント -P 3306 -u admin -p
password: 先程RDSでデータベースの作成の際に入力したパスワードを入力する。
(ここでのエンドポイントはRDSの作成したデータベースの詳細から接続とセキュリティの項目に書いてある）
- mysql > とプロンプトが返ってきたらログイン成功。
- 次のコマンドを実行してwordpressを作成する。
CREATE DATABASE wordpress(DB名) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
create user ‘ユーザー名’@’%’ identified by ‘自身のパスワード’;
grant all privileges on DB名(ここではwordpress).* to ‘ユーザー名’@’%’;
lush privileges;
- exit; と入力してmysqlからログアウトする。
## webサーバでwordpressをインストールして、ダッシュボードにアクセスする。
- 踏み台サーバ内の.ssh/にもmy-keyを配置する。
ssh -i .ssh/(先程作成したmy-keyのファイル名) ec2-user@webサーバのパブリックIPアドレス   を踏み台サーバで入力。
- webサーバにログインできたら以下のコマンドを実行して、webブラウザを立ち上げられるように以下のコマンドを実行。
sudo dnf -y install httpd
sudo systemctl enable  httpd.service
- wordpressのwebブラウザを立ち上げるために以下のコマンドを実行。
sudo dnf -y install php8.1
sudo dnf -y install php8.1-mbstring php-mysqli
wget https://ja.wordpress.org/latest-ja.tar.gz
tar xzvf latest-ja.tar.gz
cd wordpress/
sudo cp -r * /var/www/html
sudo chown apache:apache /var/www/html -R
- 以下のコマンドを実行することでwebブラウザでwordpressを閲覧できる。
sudo systemctl start httpd (すでに起動している場合sudo sytemctl restart httpd)
- webブラウザでwordpressを閲覧する時のurlはインスタンスから、webサーバを選択。詳細からパブリックDNSを入力する。
- wordpressが表示されたらデータベース名などの項目を入力する。
mysqlで入力したものを使う
データベース名:wordpress (mysqlで入力したデータベースの名前を入力)
ユーザー名:ユーザー名(同じようにmysqlで入力したユーザー名を入力)
パスワード:パスワード(同上)
データベースのホスト名:RDSのデータベースのエンドポイントを入力。
テーブル接頭辞:デフォルトのまま
- これで送信し、インストールを実行。
- 必要情報を入力する。
サイトのタイトル:自身で入力
ユーザー名:自身で入力(ログイン時に使用する)
パスワード:自身で入力(ログイン時に使用する)
メールアドレス:自身のものを入力
- これでwordpressのダッシュボードへアクセスできる。
以上を持って手順を終了

