# AWSネットワーク＆WordPress構築手順書

## ネットワーク設計

### VPC 設計
- **VPC 名称**: `s23016_vpc`
- **CIDR ブロック**: `192.168.10.0/24`

### サブネット設計

#### Public Subnet
| 名前 | CIDR ブロック |
|------|----------------|
| s23016_public_1 | 192.168.10.0/27 |
| s23016_public_2 | 192.168.10.32/27 |

#### Private Subnet
| 名前 | CIDR ブロック |
|------|----------------|
| s23016_private_1 | 192.168.10.64/27 |
| s23016_private_2 | 192.168.10.96/27 |

### ルートテーブル設計

#### Public Subnet用
- `0.0.0.0/0` → Internet Gateway
- `192.168.10.0/24` → Local

#### Private Subnet用
- `192.168.10.0/24` → Local

## サーバー構成とIP

| サーバー種別 | 名前 | サブネット | IPアドレス |
|--------------|------|------------|------------|
| 踏み台サーバ | s23016_humidai | s23016_public_2 | 192.168.10.40 |
| Webサーバ    | s23016_web     | s23016_public_2 | 192.168.10.50 |
| DBサーバ     | s23016_DB      | s23016_private_1 | 192.168.10.70 |

## セキュリティグループ設計

### 踏み台サーバ SG
- SSH：`0.0.0.0/0`

### Webサーバ SG
- SSH：`踏み台サーバ`
- HTTP：`0.0.0.0/0`

### DBサーバ SG
- SSH：`踏み台サーバ`
- MySQL：`Webサーバ`
- ICMP：`192.168.10.32/27`

---

## 実装手順

### 1. VPC とサブネットの作成
- VPC作成（CIDR: `192.168.10.0/24`）
- 上記CIDRで 4 つのサブネットを作成

### 2. インターネットゲートウェイ作成とVPCにアタッチ

### 3. ルートテーブルの作成とサブネットへの関連付け
- Public → IGWへのルート
- Private → Localのみ（NAT後に変更）

### 4. EC2インスタンス作成（踏み台・Web・DB）
- Amazon Linux 2023
- SSH鍵ペア作成 `.pem`
- IPとサブネット、セキュリティグループ設定

### 5. Apache インストール（Webサーバ）
```bash
sudo dnf -y install httpd
sudo systemctl start httpd
sudo systemctl enable httpd

# AWSで学ぶネットワーク＆サーバー構築手順書

### 6. ファイアウォールを構成する（セキュリティグループの設定）

1. セキュリティグループを開く  
2. 「インバウンドルール」をクリック  
3. 「インバウンドのルールを編集」をクリック  
4. 「ルールを追加」をクリック  
5. 通したいルールを設定（タイプ、ポート範囲、ソースIPなど）

---

### 7. DNSの設定

1. VPCをクリック  
2. 「アクション」→「VPCの設定を編集」をクリック  
3. 「DNSホスト名を有効化」にチェック  
4. 「保存」をクリック  

> `nslookup DNS名` コマンドでIPアドレスの確認が可能です。

---

### 8. プライベートサブネットを作成する

1. サブネットからアベイラビリティゾーンを確認  
2. サブネット名を決定  
3. IPv4 CIDRブロックを設定  
4. 「サブネットを作成」をクリック  

---

### 9. プライベートサブネットにサーバーを構築する

1. VPCを選択  
2. プライベートサブネットを指定  
3. パブリックIP自動割り当てを無効化  
4. プライマリIPを設定（例：`10.0.2.10`）  
5. セキュリティグループを作成し名前を設定  
6. セキュリティグループにルールを追加（タイプ、ソースIP）  
7. 「インバウンドルールを編集」→「ルールを追加」でICMPを許可（Ping確認用）  
8. 「ルールを保存」  

---

## 10. 踏み台サーバーからログインする

```bash
scp -i my-key.pem /home/s23016/.ssh my-key.pem ec2-user@<踏み台のIPまたはDNS>
chmod 400 .ssh/my-key.pem
ssh -i my-key.pem ec2-user@10.0.2.10

